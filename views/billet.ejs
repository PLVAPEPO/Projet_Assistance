<!DOCTYPE html>
<html>
<% include layout/head %>

<body>
  <%- include('layout/navbar', {pseudo: pseudo, role: role }) %>


  <h1>Billet n°<%= billet[0].IDBILLET %> - <%= billet[0].TITREBILLET%></h1>
  <% if (role != 1 && role != 3) { %>
  <p>
    <% if(billet[0].ETATBILLET != 2) { %>
    <form action="/billet/end/<%= billet[0].IDBILLET %>" method="POST">
      <input type="hidden" name="end" value="end">
      <button class="waves-effect waves-light btn green type=" submit">
        <i class="material-icons left">done</i>Problème résolu
      </button>
    </form>
    <form action="/billet/refus/<%= billet[0].IDBILLET %>" method="POST">
      <input type="hidden" name="refus" value="refus">
      <button class="waves-effect waves-light btn red type=" submit">
        <i class="material-icons left">close</i>Refuser le billet
      </button>
    </form>
    <% }%>

  </p>
  <% } %>
  <table style="width:100%">
    <tr>
      <th>Titre</th>
      <td><%= billet[0].TITREBILLET%></td>

      <th>Etat</th>
      <% if (billet[0].ETATBILLET == 0) { %>
      <td class="red center">Non affecté</td>
      <% } else if (billet[0].ETATBILLET == 1) { %>
      <td class="white center">Affecté</td>
      <% } else if (billet[0].ETATBILLET == 2) { %>
      <td class="green center">Terminé</td>
      <% } %>
    </tr>
    <tr>
      <th>Type problème</th>
      <td><%= billet[0].NOMPROBLEME %></td>

      <th>Date de création</th>
      <td>
        <%= billet[0].DATECREATIONBILLET.getDate()%>/<%= billet[0].DATECREATIONBILLET.getUTCMonth()+1%>/<%= billet[0].DATECREATIONBILLET.getUTCFullYear()%>
      </td>
    </tr>

    <tr>
      <th>Urgence</th>
      <% if (!billet[0].URGENCEBILLET) { %>
      <td>Non renseigné</td>
      <% } else  {%>
      <td><%= billet[0].URGENCEBILLET %>/5</td>
      <% } %>

      <th>Pièce Jointe</th>
      <% if (!billet[0].URGENCEBILLET) { %>
      <td>Pas de pièce jointe</td>
      <% } else  {%>
      <!-- <td><%= billet[0].PIECEJOINTEBILLET%></td> -->
      <td>EN COURS DE REALISATION</td>
      <% } %>
    </tr>

    <tr>
      <th>Description</th>
      <td><%= billet[0].MESSAGEBILLET%></td>
    </tr>
  </table>

  <h5>Commentaires :</h5>
  <ul class="collection">
    <form action="/billet/ajout" method="POST">
      <li class="collection-item">
        <input placeholder="Ajouter le titre du commentaire" name="titrecommentaire" type="text" class="validate"
          data-length="120" id="input_text" required>
        <input placeholder="Compléter le commentaire" name="libellecommentaire" type="text" class="validate"
          data-length="120" id="input_text" required>
        <input type="hidden" name="idbilletajout" value="<%= billet[0].IDBILLET %>">
        <button class="waves-effect waves-light btn indigo" type="submit" name="action">
          <i class="material-icons left">add_box</i>Ajouter
        </button>
      </li>
    </form>

    <% if(typeof comms != undefined && comms != "") {%>
    <% comms.forEach(function(comm) {%>
    <li class="collection-item">
      <h6>
        <%= comm.DATECREATIONBILLET.getDate()%>/<%= comm.DATECREATIONBILLET.getUTCMonth()+1%>/<%= comm.DATECREATIONBILLET.getUTCFullYear()%>
        : <%= comm.TITRECOMMENTAIRE %></h6>
      <%= comm.LIBELLECOMMENTAIRE %>
    </li>
    <%}) %>
    <% } else {%>
    <li class="collection-item">Il n'y a aucun commentaire</li>
    <% } %>
  </ul>
  <% include layout/script %>
</body>

</html>